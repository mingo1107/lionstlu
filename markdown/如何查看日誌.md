# 如何查看日誌 - Laradock + Yii2

## 1. Yii2 應用日誌

### 查看應用日誌（最常用）
```bash
# 查看最新的日誌（最後 50 行）
tail -n 50 frontend/runtime/logs/app.log

# 查看最新的錯誤
tail -n 200 frontend/runtime/logs/app.log | grep -i "error\|exception\|fatal"

# 即時監控日誌（推薦）
tail -f frontend/runtime/logs/app.log

# 查看所有錯誤和警告
grep -E "\[error\]|\[warning\]" frontend/runtime/logs/app.log | tail -n 50
```

### 日誌位置
- **Frontend**: `frontend/runtime/logs/app.log`
- **Backend**: `backend/runtime/logs/app.log`
- **Console**: `console/runtime/logs/app.log`

---

## 2. Laradock 容器日誌

### 進入 PHP-FPM 容器
```bash
# 進入 laradock 目錄（假設在專案根目錄的上一層）
cd ../laradock

# 進入 PHP-FPM 容器
docker-compose exec php-fpm bash

# 或直接執行命令
docker-compose exec php-fpm tail -f /var/log/php-fpm/error.log
```

### PHP 錯誤日誌位置（在容器內）
- PHP-FPM 錯誤日誌: `/var/log/php-fpm/error.log`
- PHP 錯誤日誌: `/usr/local/etc/php-fpm.d/www.conf` 中配置的 `php_admin_value[error_log]`

### 查看 PHP 錯誤日誌
```bash
# 從主機查看（需要知道容器名稱）
docker-compose exec php-fpm tail -f /var/log/php-fpm/error.log

# 或查看所有 PHP 相關日誌
docker-compose logs php-fpm | tail -n 100
```

---

## 3. Nginx 錯誤日誌

### 查看 Nginx 錯誤日誌
```bash
# 進入 laradock 目錄
cd ../laradock

# 查看 Nginx 錯誤日誌
docker-compose exec nginx tail -f /var/log/nginx/error.log

# 或查看所有 Nginx 日誌
docker-compose logs nginx | tail -n 100
```

### Nginx 日誌位置（在容器內）
- 錯誤日誌: `/var/log/nginx/error.log`
- 訪問日誌: `/var/log/nginx/access.log`

---

## 4. 快速查看 500 錯誤的方法

### 方法一：查看 Yii2 應用日誌（推薦）
```bash
# 查看最新的錯誤
tail -n 100 frontend/runtime/logs/app.log | grep -A 30 -i "error\|exception"

# 查看最近的錯誤（最後 10 個錯誤）
grep -E "\[error\]" frontend/runtime/logs/app.log | tail -n 10
```

### 方法二：查看 PHP 錯誤日誌
```bash
# 在 laradock 目錄下執行
docker-compose exec php-fpm tail -n 100 /var/log/php-fpm/error.log
```

### 方法三：查看 Nginx 錯誤日誌
```bash
# 在 laradock 目錄下執行
docker-compose exec nginx tail -n 100 /var/log/nginx/error.log
```

### 方法四：啟用錯誤顯示（開發環境）
修改 `frontend/web/index.php`，暫時啟用錯誤顯示：

```php
<?php
// 啟用錯誤顯示
ini_set('display_errors', 1);
error_reporting(E_ALL);

defined('YII_DEBUG') or define('YII_DEBUG', true);
defined('YII_ENV') or define('YII_ENV', 'dev'); // 改為 dev 以顯示詳細錯誤
```

---

## 5. 實用命令集合

### 查看所有相關日誌（一條命令）
```bash
# 在專案根目錄執行
echo "=== Yii2 應用日誌 ===" && \
tail -n 20 frontend/runtime/logs/app.log && \
echo -e "\n=== PHP 錯誤日誌 ===" && \
cd ../laradock && docker-compose exec -T php-fpm tail -n 20 /var/log/php-fpm/error.log && \
echo -e "\n=== Nginx 錯誤日誌 ===" && \
docker-compose exec -T nginx tail -n 20 /var/log/nginx/error.log
```

### 清理日誌（如果需要）
```bash
# 清空 Yii2 應用日誌（請謹慎使用）
> frontend/runtime/logs/app.log

# 清空 PHP 錯誤日誌
cd ../laradock
docker-compose exec php-fpm sh -c "> /var/log/php-fpm/error.log"
```

---

## 6. 常見問題排查

### 如果看不到日誌
1. 檢查日誌文件權限：
   ```bash
   ls -la frontend/runtime/logs/
   chmod -R 777 frontend/runtime/logs/
   ```

2. 檢查容器是否運行：
   ```bash
   cd ../laradock
   docker-compose ps
   ```

3. 檢查 Yii2 日誌配置：
   查看 `frontend/config/main.php` 中的 `log` 配置

### 如果日誌文件不存在
```bash
# 創建日誌目錄（如果不存在）
mkdir -p frontend/runtime/logs
chmod -R 777 frontend/runtime/logs
```

---

## 7. 推薦的日誌查看流程

1. **首先查看 Yii2 應用日誌**（最可能找到錯誤）
   ```bash
   tail -f frontend/runtime/logs/app.log
   ```

2. **如果沒有找到，查看 PHP 錯誤日誌**
   ```bash
   cd ../laradock
   docker-compose exec php-fpm tail -f /var/log/php-fpm/error.log
   ```

3. **最後查看 Nginx 錯誤日誌**
   ```bash
   docker-compose exec nginx tail -f /var/log/nginx/error.log
   ```

---

## 注意事項

- 生產環境請勿啟用 `display_errors`
- 定期清理日誌文件，避免占用過多空間
- 確保 `runtime` 目錄有寫入權限
- Laradock 容器名稱可能因配置而異，請根據實際情況調整

