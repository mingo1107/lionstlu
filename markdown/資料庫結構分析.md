# 資料庫結構分析 - case_isharer

## 資料庫概覽

資料庫名稱：`case_isharer`  
字符集：`utf8mb4`  
排序規則：`utf8mb4_unicode_ci`

---

## 資料表分類

### 1. 權限管理系統

#### `access` - 權限項目表
後台權限項目定義
- `id` (int, PK, AUTO_INCREMENT)
- `parent_id` (int) - 父權限ID，用於階層結構
- `pattern` (varchar(64)) - 權限模式/路徑
- `status` (int) - 狀態
- `name` (varchar(64)) - 權限名稱
- `link` (varchar(128)) - 連結
- `sort` (int) - 排序

#### `access_role` - 權限角色表
後台角色群組
- `id` (int, PK, AUTO_INCREMENT)
- `name` (varchar(128)) - 角色名稱
- `access_list` (text, JSON) - 權限ID列表（JSON格式）
- `create_time` (datetime)
- `update_time` (datetime)

#### `access_user` - 使用者權限表
後台使用者的角色和權限設定
- `id` (int, PK, AUTO_INCREMENT)
- `user_id` (int) - 後台使用者ID
- `role_id` (int) - 角色ID
- `access_list` (text, JSON) - 自訂權限列表（JSON格式）
- `create_time` (datetime)
- `update_time` (datetime)

#### `user_access` - 後台使用者權限關聯表
後台使用者的權限關聯（多對多）
- `id` (int, PK, AUTO_INCREMENT)
- `access_id` (int) - 權限ID
- `user_id` (int) - 使用者ID
- `create_time` (datetime)

---

### 2. 使用者系統

#### `user` - 後台使用者表
後台管理員
- `id` (int, PK, AUTO_INCREMENT)
- `parent_id` (int) - 上級使用者ID
- `username` (varchar(64)) - 帳號
- `password_hash` (varchar(256)) - 密碼雜湊
- `password_reset_token` (varchar(256)) - 密碼重設令牌
- `email` (varchar(256)) - 電子郵件
- `name` (varchar(128)) - 姓名
- `status` (int) - 狀態
- `role` (int) - 角色
- `birthday` (date) - 生日
- `zip` (varchar(8)) - 郵遞區號
- `country` (varchar(64)) - 國家
- `city` (varchar(64)) - 城市
- `district` (varchar(64)) - 區域
- `address` (varchar(128)) - 地址
- `mobile` (varchar(64)) - 手機
- `create_time` (datetime)
- `update_time` (datetime)
- `login_count` (int) - 登入次數
- `last_login_ip` (varchar(20)) - 最後登入IP
- `last_login_time` (datetime) - 最後登入時間

#### `user_activity_log` - 後台使用者活動日誌表
- `id` (int, PK, AUTO_INCREMENT)
- `user_id` (int) - 使用者ID
- `type` (int) - 活動類型
- `ip` (varchar(32)) - 客戶端IP
- `create_time` (datetime)
- **索引**：`user_id`, `(user_id, type)`

---

### 3. 會員系統

#### `member` - 前台會員表
前台註冊會員
- `id` (int, PK, AUTO_INCREMENT)
- `username` (varchar(64)) - 帳號
- `password_hash` (varchar(256)) - 密碼雜湊
- `password_reset_token` (varchar(256)) - 密碼重設令牌
- `register_token` (varchar(32)) - 註冊驗證令牌（Email 驗證用）
- `email` (varchar(256)) - 電子郵件
- `name` (varchar(128)) - 姓名
- `status` (int) - 狀態（0:下線, 1:上線）
- `validate` (int) - 認證狀態（0:尚未認證, 1:已認證）
- `role` (int) - 角色
- `gender` (varchar(2)) - 性別（M/F）
- `birthday` (date) - 生日
- `zip` (varchar(8)) - 郵遞區號
- `country` (varchar(64)) - 國家
- `city` (varchar(64)) - 城市
- `district` (varchar(64)) - 區域
- `address` (varchar(128)) - 地址
- `mobile` (varchar(64)) - 手機
- `area_id` (int) - 區域ID（外鍵：`area.id`）
- `create_time` (datetime)
- `update_time` (datetime)
- `login_count` (int) - 登入次數
- `last_login_ip` (varchar(20)) - 最後登入IP
- `last_login_time` (datetime) - 最後登入時間

#### `member_activity_log` - 會員活動日誌表
- `id` (int, PK, AUTO_INCREMENT)
- `user_id` (int) - 會員ID
- `type` (int) - 活動類型
- `ip` (varchar(32)) - 客戶端IP
- `create_time` (datetime)
- **索引**：`user_id`, `(user_id, type)`

#### `member_bind` - 會員綁定表
SNS平台綁定（Facebook、Google等）
- `id` (int, PK, AUTO_INCREMENT)
- `user_id` (int) - 會員ID
- `platform` (varchar(16)) - SNS平台名稱
- `platform_uid` (varchar(512)) - 平台使用者ID
- `status` (int) - 狀態（0:停用, 1:啟用）
- `create_time` (datetime)
- `update_time` (datetime)

#### `area` - 區域表
區域管理
- `id` (int, PK, AUTO_INCREMENT)
- `area_name` (varchar(128)) - 區域名稱
- `sort` (int) - 排序
- `user_id` (int) - 建立者（後台使用者ID）
- `create_time` (datetime)
- `update_time` (datetime)

---

### 4. 內容管理系統

#### `article` - 文章表
主要內容文章
- `id` (int, PK, AUTO_INCREMENT)
- `category_id` (int) - 分類ID
- `user_id` (int) - 建立者（後台使用者）
- `ad_type` (int) - 廣告類型（0:預設, 1:投票, 2:商品, 3:外部連結）
- `ad_link` (varchar(512)) - 廣告連結
- `ad_id` (int) - 廣告ID（投票/商品ID）
- `ad_deadline` (int) - 廣告期限設定
- `ad_start_time` (date) - 廣告開始時間
- `ad_end_time` (date) - 廣告結束時間
- `status` (int) - 狀態（0:下線, 1:上線, 2:焦點）
- `title` (varchar(256)) - 標題
- `og_description` (text) - OG描述
- `og_keywords` (varchar(512)) - OG關鍵字
- `content_0` ~ `content_7` (text) - 內容區塊（8個）
- `cover_media` (varchar(512), JSON) - 封面媒體
- `media` (text, JSON) - 媒體列表（最多8個）
- `views` (decimal(10,0)) - 瀏覽數
- `share_count` (int) - 分享數
- `share_location` (varchar(256)) - 分享地區
- `picsee_link` (varchar(128)) - Picsee短網址
- `deadline` (tinyint) - 期限設定（0:永遠, 1:限時）
- `start_time` (datetime) - 開始時間
- `end_time` (datetime) - 結束時間
- `sort` (int) - 排序
- `create_time` (datetime)
- `update_time` (datetime)

#### `article_category` - 文章分類表
- `id` (int, PK, AUTO_INCREMENT)
- `status` (int) - 狀態
- `name` (varchar(64)) - 分類名稱
- `sort` (int) - 排序
- `create_time` (datetime)
- `update_time` (datetime)

---

### 5. 商品系統

#### `product` - 商品表
- `id` (int, PK, AUTO_INCREMENT)
- `user_id` (int) - 建立者（後台使用者）
- `status` (int) - 狀態
- `standard_type` (tinyint) - 規格類型（0:單規, 1:雙規）
- `name` (varchar(256)) - 商品名稱
- `sn` (varchar(128)) - 產品編號
- `owner_id` (int) - 擁有者ID
- `views` (decimal(10,0)) - 瀏覽數
- `clicks` (decimal(10,0)) - 點擊數
- `deadline` (tinyint) - 期限設定
- `start_time` (datetime) - 開始時間
- `end_time` (datetime) - 結束時間
- `intro` (text) - 簡介
- `note` (text) - 備註
- `media` (text, JSON) - 媒體列表
- `sort` (int) - 排序
- `create_time` (datetime)
- `update_time` (datetime)

#### `standard` - 商品規格表
- `id` (int, PK, AUTO_INCREMENT)
- `product_id` (int) - 商品ID（外鍵）
- `name` (varchar(256)) - 規格名稱
- `name2` (varchar(256)) - 雙規名稱（第二規格）
- `sn` (varchar(32)) - 規格編號
- `status` (tinyint(1)) - 狀態
- `original_price` (decimal(10,0)) - 原價
- `price` (decimal(10,0)) - 售價
- `shipping_fee` (decimal(10,0)) - 運費
- `stock` (int) - 庫存
- `sold_quantity` (int) - 已售數量
- `intro` (text) - 簡介
- `media` (text, JSON) - 媒體
- `sort` (int) - 排序
- `create_time` (datetime)
- `update_time` (datetime)
- **索引**：`product_id`

---

### 6. 訂單系統

#### `orders` - 訂單主表
- `id` (int, PK, AUTO_INCREMENT)
- `member_id` (int) - 會員ID
- `no` (varchar(32), UNIQUE) - 訂單編號（唯一）
- `status` (int) - 訂單狀態
- `payment_id` (varchar(64)) - 付款ID
- `shipment_id` (varchar(64)) - 物流ID
- `net` (decimal(10,0)) - 淨額
- `gross` (decimal(10,0)) - 總額
- `payment_fee` (decimal(10,0)) - 金流手續費
- `shipping_fee` (decimal(10,0)) - 物流手續費
- `tax` (decimal(10,0)) - 稅額
- **訂購人資訊**：
  - `email`, `name`, `mobile`
  - `country`, `city`, `district`, `address`, `zip`
- **收貨人資訊**（可與訂購人不同）：
  - `receiver_email`, `receiver_name`, `receiver_mobile`
  - `receiver_country`, `receiver_city`, `receiver_district`, `receiver_address`, `receiver_zip`
- `receive_time` (datetime) - 預計收貨日
- **發票資訊**：
  - `card_digit` (varchar(4)) - 卡號末四碼
  - `invoice_no` (varchar(32)) - 發票號碼
  - `invoice_type` (int) - 發票類型
  - `invoice_name` (varchar(32)) - 發票抬頭
  - `invoice_country`, `invoice_city`, `invoice_district`, `invoice_address` - 發票地址
- `note` (text) - 備註
- `create_time` (datetime)
- `update_time` (datetime)
- **索引**：`member_id`, `no` (UNIQUE)

#### `orders_detail` - 訂單明細表
- `id` (int, PK, AUTO_INCREMENT)
- `standard_id` (int) - 規格ID
- `orders_id` (int) - 訂單ID
- `tax_type` (int) - 商品稅務類型
- `status` (int) - 狀態
- `quantity` (decimal(10,0)) - 訂購數量
- `net` (decimal(10,0)) - 淨額
- `gross` (decimal(10,0)) - 總額
- `shipping_fee` (decimal(10,0)) - 運費
- `tax` (decimal(10,0)) - 稅額
- `note` (text) - 備註
- `create_time` (datetime)
- `update_time` (datetime)

#### `orders_status_flow` - 訂單狀態流程表
訂單狀態變更記錄
- `id` (int, PK, AUTO_INCREMENT)
- `orders_id` (int) - 訂單ID
- `status` (int) - 訂單狀態
- `orders_detail_id_list` (varchar(512)) - 出貨的訂單明細ID列表（陣列格式）
- `shipment_no` (varchar(128)) - 物流單號
- `total` (decimal(10,0)) - 總額
- `create_user` (varchar(32)) - 建立者
- `create_time` (datetime)
- `update_user` (varchar(32)) - 更新者
- `update_time` (datetime)
- `note` (text) - 備註
- `shipment_fee` (decimal(10,0)) - 物流手續費
- `fee` (decimal(10,0)) - 代收手續費
- `vendor_status` (varchar(16)) - 廠商拋檔狀態
- `vendor_id` (varchar(16)) - EC廠商代號

#### `orders_daily_count` - 訂單每日統計表
- `id` (int, PK, AUTO_INCREMENT)
- `count` (int) - 訂單數量
- `date` (date) - 日期
- `create_time` (datetime)
- `update_time` (datetime)

---

### 7. 投票系統

#### `vote` - 投票表
- `id` (int, PK, AUTO_INCREMENT)
- `user_id` (int) - 建立者（後台使用者）
- `name` (varchar(512)) - 投票名稱
- `owner_id` (int) - 擁有者ID
- `status` (int) - 狀態
- `views` (decimal(10,0)) - 瀏覽數
- `deadline` (int) - 期限設定
- `vote_limit` (varchar(12)) - 投票限制（'once':只能一票, 'daily':一天一票）
- `start_time` (datetime) - 開始時間
- `end_time` (datetime) - 結束時間
- `sort` (int) - 排序
- `create_time` (datetime)
- `update_time` (datetime)

#### `vote_option` - 投票選項表
- `id` (int, PK, AUTO_INCREMENT)
- `vote_id` (int) - 投票ID
- `name` (varchar(512)) - 選項名稱
- `count` (int) - 票數
- `create_time` (datetime)
- `update_time` (datetime)

#### `vote_record` - 投票記錄表
- `id` (int, PK, AUTO_INCREMENT)
- `member_id` (int) - 會員ID
- `vote_id` (int) - 投票ID
- `option_id` (int) - 選項ID
- `ip` (varchar(32)) - IP位址
- `create_time` (datetime)

---

### 8. 其他功能

#### `banner` - 橫幅表
首頁輪播圖/橫幅
- `id` (int, PK, AUTO_INCREMENT)
- `status` (int) - 狀態
- `type` (int) - 類型
- `name` (varchar(128)) - 名稱
- `link` (varchar(256)) - 連結
- `media` (text, JSON) - 桌面版媒體
- `media_m` (text, JSON) - 手機版媒體
- `sort` (int) - 排序
- `create_time` (datetime)
- `update_time` (datetime)

#### `cooperate` - 合作提案表
- `id` (int, PK, AUTO_INCREMENT)
- `status` (int) - 狀態
- `title` (varchar(128)) - 標題
- `type` (varchar(32)) - 類型
- `content` (text) - 內容
- `member_id` (int) - 會員ID
- `create_time` (datetime)
- `name` (varchar(128)) - 姓名
- `email` (varchar(256)) - 電子郵件
- `mobile` (varchar(64)) - 手機

#### `customer_service` - 客服表
- `id` (int, PK, AUTO_INCREMENT)
- `status` (int) - 狀態
- `category` (int) - 分類
- `title` (varchar(128)) - 標題
- `content` (text) - 內容
- `member_id` (int) - 會員ID
- `create_time` (datetime)
- `name` (varchar(128)) - 姓名
- `email` (varchar(256)) - 電子郵件
- `mobile` (varchar(64)) - 手機

#### `customer_service_log` - 客服日誌表
客服對話記錄
- `id` (int, PK, AUTO_INCREMENT)
- `customer_service_id` (int) - 客服單ID
- `role` (tinyint) - 角色（0:會員, 1:管理員）
- `content` (text) - 內容
- `owner_id` (int) - 發送者ID（會員或管理員）
- `create_time` (datetime)

---

## 資料表關聯圖

```
user (後台使用者)
├── user_access (權限關聯)
│   └── access (權限項目)
├── access_user (角色權限)
│   └── access_role (角色)
└── user_activity_log (活動日誌)

member (前台會員)
├── area (區域)
├── member_bind (SNS綁定)
├── member_activity_log (活動日誌)
├── orders (訂單)
│   ├── orders_detail (訂單明細)
│   │   └── standard (商品規格)
│   │       └── product (商品)
│   └── orders_status_flow (狀態流程)
├── vote_record (投票記錄)
│   └── vote (投票)
│       └── vote_option (投票選項)
├── cooperate (合作提案)
└── customer_service (客服)
    └── customer_service_log (客服日誌)

article (文章)
├── article_category (分類)
└── 可關聯 vote, product (透過 ad_type/ad_id)

banner (橫幅)
```

---

## 重要設計特點

### 1. 媒體儲存
- 使用 JSON 格式儲存媒體資料
- `cover_media`: 單一媒體（JSON字串）
- `media`: 多媒體陣列（JSON字串）
- 支援桌面版和手機版媒體（如 `banner.media` 和 `banner.media_m`）

### 2. 權限系統
- 三層權限設計：`access` → `access_role` → `access_user`
- 支援角色群組和個別使用者自訂權限
- 使用 JSON 格式儲存權限列表

### 3. 訂單系統
- 支援分次出貨（`orders_status_flow` 記錄每次出貨）
- 訂購人和收貨人資訊分離
- 完整的發票資訊

### 4. 商品系統
- 支援單規和雙規商品
- 規格與商品分離設計（`product` + `standard`）

### 5. 文章系統
- 8個內容區塊（`content_0` ~ `content_7`）
- 支援嵌入投票、商品、外部連結（`ad_type`）
- 完整的 SEO 設定（OG tags）

### 6. 投票系統
- 支援投票限制（once/daily）
- 記錄投票IP防止重複投票

---

## 索引設計

### 主要索引
- `orders.no` - UNIQUE（訂單編號唯一）
- `orders.member_id` - 會員訂單查詢
- `standard.product_id` - 商品規格查詢
- `member_activity_log.user_id`, `(user_id, type)` - 活動日誌查詢
- `user_activity_log.user_id`, `(user_id, type)` - 後台活動日誌查詢

---

## 注意事項

1. **字符集**：全部使用 `utf8mb4_unicode_ci`，支援完整的 Unicode 字符
2. **時間欄位**：大部分表都有 `create_time` 和 `update_time`
3. **狀態欄位**：多數表都有 `status` 欄位用於啟用/停用
4. **排序欄位**：內容相關表都有 `sort` 欄位用於自訂排序
5. **JSON 欄位**：媒體、權限列表等使用 JSON 格式儲存

